# 我在项目中用实际用到的22个Vue优化技巧

> 代码优化

## v-for 中使用 key

使用 `v-for` 更新已渲染的元素列表时，默认用就地复用策略；列表数据修改的时候，他会根据 `key` 值去判断某个值是否修改，如果修改，则重新渲染这一项，否则复用之前的元素；

使用key的注意事项：

- 不要使用可能重复的或者可能变化 `key` 值（控制台也会给出提醒）
- 如果数组中的数据有状态需要维持时（例如输入框），不要使用数组的 `index` 作为 `key` 值，因为如果在数组中插入或者移除一个元素时，其后面的元素 `index` 将会变化，这回让vue进行原地复用时错误的绑定状态。
- 如果数组中没有唯一的 `key`值可用，且数组更新时不是全量更新而是采用类似push，splice来插入或者移除数据时，可以考虑对其添加一个 `key` 字段，值为 Symbol() 即可保证唯一。

> 何时使用何种key？

这是一个非常有考究的问题，首先你要知道 vue 中的 `原地复用` （大概就是 `虚拟dom` 变化时，两个 `虚拟dom` 节点 的 `key` 如果一样就不会重新创建节点，而是修改原来的节点）

当我们渲染的数据不需要保持状态时，例如常见的单纯的表格分页渲染（不包含输入，只是展示）、下拉加载更多等场景，那么使用 `index` 作为 `key` 再好不过，因为进入下一页或者上一页时就会原地复用之前的节点，而不是重新创建，如果使用唯一的 `id` 作为 `key` 反而会重新创建dom，性能相对较低。

此外使用 `index` 作为 `key` 我还应该要尽量避免对数组的中间进行 增加/删除 等会影响后面元素key变化的操作。这会让 vue 认为后面所有元素都发生了变化，导致多余的对比和原地复用。

所以使用 index 作为 key 需要满足：

1. 数据没有独立的状态
2. 数据不会进行 增加/删除 等会影响后面元素key变化的操作

> 哪何时使用 id 作为 key 呢？

对于大多数数据的 `id` 都是唯一的，这无疑的一个 `key` 的优选答案。对于任何大多数情况使用 `id` 作为 `key` 都不会出现上面 `bug`。但是如果你需要考虑性能问题，那就就要思考是否应该使用原地复用了。

同样是上面的分页数据展示，如果使用 `id` 作为 `key` ，可想而知每一页的每一条数据 `id` 都是不一样的，所以当换页时两颗 虚拟DOM树 的节点的 `key` 完全不一致，vue 就会移除原来的节点然后创建新的节点。可想而知效率会更加低下。但是他也有它的优点。唯一的 `key` 可以帮助 `diff` 更加精确的为我们绑定状态，这尤其适合数据有独立的状态的场景，例如带输入框或者单选框的列表数据。

所以何时使用 `id` 作为 `key`？只有一点：

1. 无法使用 `index` 作为 `key` 的时候